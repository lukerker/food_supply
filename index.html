<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‚ö° Ë£úÁµ¶Âø´ÈÅ∏ | Quick Order</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f3f4f6;
            -webkit-tap-highlight-color: transparent;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .tap-scale:active {
            transform: scale(0.97);
        }

        .glass-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        @keyframes scaleIn {
            from {
                transform: scale(0);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .check-icon {
            animation: scaleIn 0.2s cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#4f46e5',
                        success: '#10b981',
                    }
                }
            }
        }
    </script>
</head>

<body class="pb-32 text-gray-800">

    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 z-30 glass-nav shadow-sm">
        <div class="px-4 py-3 flex justify-between items-center max-w-2xl mx-auto">
            <h1 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary">
                üö¢ Ë£úÁµ¶Âø´ÈÅ∏
            </h1>
        </div>
        <nav class="flex overflow-x-auto hide-scrollbar px-2 pb-2 gap-2 max-w-2xl mx-auto" id="categoryTabs"></nav>
    </header>

    <div class="h-28"></div>

    <main class="max-w-2xl mx-auto px-3 space-y-6">
        <section>
            <div id="presetsGrid" class="grid grid-cols-2 md:grid-cols-3 gap-3"></div>
        </section>
    </main>

    <!-- FABs -->
    <div class="fixed bottom-6 w-full max-w-2xl left-1/2 transform -translate-x-1/2 px-4 z-30 pointer-events-none">
        <div class="flex justify-between items-end pointer-events-auto">
            <!-- Left: Add Custom -->
            <button onclick="openCustomModal()"
                class="bg-gray-800 text-white w-14 h-14 rounded-full shadow-xl flex items-center justify-center tap-scale active:bg-black">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
            </button>

            <!-- Right: View Cart -->
            <button onclick="openCart()"
                class="bg-primary text-white pl-5 pr-6 h-14 rounded-full shadow-xl flex items-center gap-3 tap-scale relative">
                <div class="relative">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    <span id="cartBadge"
                        class="absolute -top-2 -right-2 bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full min-w-[18px] text-center hidden">0</span>
                </div>
                <span class="font-bold text-lg">Ë≥ºÁâ©Ëªä</span>
            </button>
        </div>
    </div>

    <!-- Modals -->

    <!-- Quantity Modal (For Presets) -->
    <div id="qtyModal"
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm hidden opacity-0 transition-opacity duration-200">
        <div class="bg-white w-[90%] max-w-sm rounded-2xl shadow-2xl p-6 transition-transform scale-95 duration-200"
            id="qtyModalContent">
            <h3 class="text-xl font-bold text-gray-800 mb-1" id="modalItemName">Item Name</h3>
            <p class="text-sm text-gray-500 mb-6">Ë´ãËº∏ÂÖ•Êï∏Èáè (Enter Quantity)</p>

            <div class="flex items-center gap-3 mb-8">
                <button onclick="adjustModalQty('modalQtyInput', -1)"
                    class="w-12 h-12 rounded-xl bg-gray-100 text-gray-600 text-2xl font-bold active:bg-gray-200">-</button>
                <input type="number" id="modalQtyInput"
                    class="flex-1 text-center text-3xl font-bold border-b-2 border-primary outline-none py-2"
                    value="10">
                <button onclick="adjustModalQty('modalQtyInput', 1)"
                    class="w-12 h-12 rounded-xl bg-primary text-white text-2xl font-bold active:bg-blue-700">+</button>
            </div>
            <div class="text-center text-gray-400 text-sm mb-6" id="modalUnitHint">ÂñÆ‰Ωç: ÂÄã</div>

            <div class="flex gap-3">
                <button onclick="closeQtyModal()"
                    class="flex-1 py-3 rounded-xl bg-gray-100 text-gray-600 font-bold active:bg-gray-200">ÂèñÊ∂à</button>
                <button onclick="confirmAddToOrder()"
                    class="flex-1 py-3 rounded-xl bg-primary text-white font-bold shadow-lg shadow-blue-500/30 active:scale-95">Á¢∫ÂÆö</button>
            </div>
        </div>
    </div>

    <!-- Edit Cart Item Modal -->
    <div id="editModal"
        class="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm hidden opacity-0 transition-opacity duration-200">
        <div class="bg-white w-[90%] max-w-sm rounded-2xl shadow-2xl p-6 transition-transform scale-95 duration-200"
            id="editModalContent">
            <h3 class="text-xl font-bold text-gray-800 mb-1" id="editItemName">Item Name</h3>
            <p class="text-sm text-gray-500 mb-6">‰øÆÊîπÊï∏ÈáèËàáÂñÆ‰Ωç (Edit Item)</p>

            <div class="flex items-center gap-3 mb-4">
                <button onclick="adjustModalQty('editQtyInput', -1)"
                    class="w-12 h-12 rounded-xl bg-gray-100 text-gray-600 text-2xl font-bold active:bg-gray-200">-</button>
                <input type="number" id="editQtyInput"
                    class="flex-1 text-center text-3xl font-bold border-b-2 border-primary outline-none py-2" value="1">
                <button onclick="adjustModalQty('editQtyInput', 1)"
                    class="w-12 h-12 rounded-xl bg-primary text-white text-2xl font-bold active:bg-blue-700">+</button>
            </div>

            <div class="mb-8">
                <label class="text-xs font-bold text-gray-500 ml-1">ÂñÆ‰Ωç (Unit)</label>
                <input type="text" id="editUnitInput"
                    class="w-full bg-gray-50 p-3 rounded-lg border-none focus:ring-2 focus:ring-primary font-bold text-lg text-center mt-1"
                    placeholder="ÂñÆ‰Ωç" value="">
            </div>

            <div class="flex gap-3">
                <button onclick="closeEditModal()"
                    class="flex-1 py-3 rounded-xl bg-gray-100 text-gray-600 font-bold active:bg-gray-200">ÂèñÊ∂à</button>
                <button onclick="confirmEdit()"
                    class="flex-1 py-3 rounded-xl bg-primary text-white font-bold shadow-lg shadow-blue-500/30 active:scale-95">Êõ¥Êñ∞</button>
            </div>
        </div>
    </div>


    <!-- Custom Item Modal -->
    <div id="customModal"
        class="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm hidden opacity-0 transition-opacity duration-200">
        <div class="bg-white w-full sm:w-[90%] max-w-sm sm:rounded-2xl rounded-t-2xl shadow-2xl p-6 transition-transform translate-y-full sm:translate-y-0 duration-300"
            id="customModalContent">
            <h3 class="text-xl font-bold text-gray-800 mb-4">‚ú® Êñ∞Â¢ûËá™Ë®ÇÂìÅÈ†Ö</h3>

            <div class="space-y-4 mb-6">
                <div>
                    <label class="text-xs font-bold text-gray-500">ÂàÜÈ°û</label>
                    <select id="customCat"
                        class="w-full bg-gray-50 p-3 rounded-lg border-none focus:ring-2 focus:ring-primary font-bold text-lg">
                        <option value="È£üÂìÅ">È£üÂìÅ (Food)</option>
                        <option value="‰πæË≤®">Êó•Áî®/‰πæË≤® (Daily)</option>
                        <option value="‰∫îÈáë">‰∫îÈáë (Hardware)</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-500">ÂìÅÂêç</label>
                    <input type="text" id="customName"
                        class="w-full bg-gray-50 p-3 rounded-lg border-none focus:ring-2 focus:ring-primary font-bold text-lg"
                        placeholder="Ëº∏ÂÖ•ÂêçÁ®±...">
                </div>
                <div class="flex gap-3">
                    <div class="flex-1">
                        <label class="text-xs font-bold text-gray-500">Êï∏Èáè</label>
                        <input type="number" id="customQty"
                            class="w-full bg-gray-50 p-3 rounded-lg border-none focus:ring-2 focus:ring-primary font-bold text-lg text-center"
                            value="10">
                    </div>
                    <div class="flex-1">
                        <label class="text-xs font-bold text-gray-500">ÂñÆ‰Ωç</label>
                        <input type="text" id="customUnit"
                            class="w-full bg-gray-50 p-3 rounded-lg border-none focus:ring-2 focus:ring-primary font-bold text-lg text-center"
                            value="ÂÄã">
                    </div>
                </div>
            </div>

            <div class="flex gap-3">
                <button onclick="closeCustomModal()"
                    class="flex-1 py-3 rounded-xl bg-gray-100 text-gray-600 font-bold active:bg-gray-200">ÂèñÊ∂à</button>
                <button onclick="confirmAddCustom()"
                    class="flex-1 py-3 rounded-xl bg-gray-800 text-white font-bold shadow-lg active:scale-95">Âä†ÂÖ•Ê∏ÖÂñÆ</button>
            </div>
        </div>
    </div>

    <!-- Cart Drawer -->
    <div id="cartDrawer"
        class="fixed inset-0 z-50 transform translate-x-full transition-transform duration-300 bg-gray-50 flex flex-col">
        <div class="bg-white px-4 py-3 shadow-sm border-b flex justify-between items-center">
            <h2 class="text-xl font-bold text-gray-800">üõí Ë≥ºÁâ©Ëªä</h2>
            <button onclick="closeCart()" class="p-2 bg-gray-100 rounded-full hover:bg-gray-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <div class="flex-1 overflow-y-auto p-4 space-y-3" id="cartList">
            <!-- Items injected here -->
        </div>

        <div class="bg-white p-4 border-t safe-area-bottom">
            <button onclick="downloadJSON()"
                class="w-full bg-primary text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-500/30 text-lg flex justify-center items-center gap-2 active:scale-98 transition-transform">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
                ÂåØÂá∫ JSON Ê™îÊ°à
            </button>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast"
        class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/80 text-white px-6 py-3 rounded-full opacity-0 pointer-events-none transition-opacity duration-300 z-[70] text-sm font-bold">
        Msg</div>

    <script>
        // --- Data ---
        const TABS = [
            { id: 'food', label: 'È£üÂìÅ', icon: 'üçé', sourceCategory: 'È£üÂìÅ' },
            { id: 'daily', label: 'Êó•Áî®', icon: 'üßª', sourceCategory: '‰πæË≤®' },
            { id: 'hardware', label: '‰∫îÈáë', icon: 'üîß', sourceCategory: '‰∫îÈáë' },
        ];
        const presetsData = [
            { "id": 1, "category": "È£üÂìÅ", "item": "ÈõûËõã", "quantity": 600, "unit": "ÂÄã", "common": true },
            { "id": 2, "category": "È£üÂìÅ", "item": "ÈõûËÇâ", "quantity": 60, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 3, "category": "È£üÂìÅ", "item": "ÈõûËÖø", "quantity": 30, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 4, "category": "È£üÂìÅ", "item": "ÈõûÁà™", "quantity": 20, "unit": "ÂÖ¨Êñ§", "common": false },
            { "id": 5, "category": "È£üÂìÅ", "item": "ÈõûÂøÉ", "quantity": 10, "unit": "ÂÖ¨Êñ§", "common": false },
            { "id": 6, "category": "È£üÂìÅ", "item": "Ë±¨ËÖøËÇâ", "quantity": 60, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 7, "category": "È£üÂìÅ", "item": "‰∫îËä±ËÇâ", "quantity": 40, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 8, "category": "È£üÂìÅ", "item": "Ë±¨ËÖ≥", "quantity": 30, "unit": "ÂÖ¨Êñ§", "common": false },
            { "id": 9, "category": "È£üÂìÅ", "item": "Ë±¨ËÇù", "quantity": 20, "unit": "ÂÖ¨Êñ§", "common": false },
            { "id": 10, "category": "È£üÂìÅ", "item": "Ë±¨ËÄ≥Êúµ", "quantity": 30, "unit": "ÂÖ¨Êñ§", "common": false },
            { "id": 11, "category": "È£üÂìÅ", "item": "Ë±¨ÊéíÈ™®", "quantity": 40, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 12, "category": "È£üÂìÅ", "item": "È≠ö", "quantity": 60, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 13, "category": "È£üÂìÅ", "item": "Ëä±ËèúÔºàÁôΩÔºâ", "quantity": 30, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 14, "category": "È£üÂìÅ", "item": "ÁôΩËèú", "quantity": 50, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 15, "category": "È£üÂìÅ", "item": "ÂåÖËèú", "quantity": 50, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 16, "category": "È£üÂìÅ", "item": "Á©∫ÂøÉËèú", "quantity": 30, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 17, "category": "È£üÂìÅ", "item": "Â∞èÁôΩËèú", "quantity": 30, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 18, "category": "È£üÂìÅ", "item": "È¶ôËèú", "quantity": 20, "unit": "ÂÖ¨Êñ§", "common": false },
            { "id": 19, "category": "È£üÂìÅ", "item": "Ëè†Ëèú", "quantity": 20, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 20, "category": "È£üÂìÅ", "item": "ÂÜ¨Áìú", "quantity": 50, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 21, "category": "È£üÂìÅ", "item": "ÂçóÁìú", "quantity": 30, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 22, "category": "È£üÂìÅ", "item": "ÈªÉÁìú", "quantity": 20, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 23, "category": "È£üÂìÅ", "item": "Âú∞Áìú", "quantity": 30, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 24, "category": "È£üÂìÅ", "item": "Ë•øËäπ", "quantity": 10, "unit": "ÂÖ¨Êñ§", "common": false },
            { "id": 25, "category": "È£üÂìÅ", "item": "Ë•øÁ¥ÖÊüø", "quantity": 10, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 26, "category": "È£üÂìÅ", "item": "ËåÑÂ≠ê", "quantity": 10, "unit": "ÂÖ¨Êñ§", "common": false },
            { "id": 27, "category": "È£üÂìÅ", "item": "Ë±ÜËäΩ", "quantity": 10, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 28, "category": "È£üÂìÅ", "item": "Ë±ÜËÖê", "quantity": 10, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 29, "category": "È£üÂìÅ", "item": "ÂúüË±Ü", "quantity": 50, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 30, "category": "È£üÂìÅ", "item": "Ëñë", "quantity": 5, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 31, "category": "È£üÂìÅ", "item": "Ê¥ãËî•", "quantity": 30, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 32, "category": "È£üÂìÅ", "item": "Ëî•", "quantity": 2, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 1, "category": "‰πæË≤®", "item": "Â§ßÁ±≥", "quantity": 240, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 2, "category": "‰πæË≤®", "item": "È∫µÊ¢ù", "quantity": 20, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 3, "category": "‰πæË≤®", "item": "ÊéíÈ™®ÈõûÊ±ÅÈ∫µ", "quantity": 10, "unit": "ÁÆ±", "common": true },
            { "id": 4, "category": "‰πæË≤®", "item": "È∫µÁ≤â", "quantity": 50, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 5, "category": "‰πæË≤®", "item": "ÈÖµÊØçÁ≤â", "quantity": 10, "unit": "Áõí", "common": true },
            { "id": 6, "category": "‰πæË≤®", "item": "Á±≥Á≤â", "quantity": 20, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 7, "category": "‰πæË≤®", "item": "ÂíñÂï°", "quantity": 50, "unit": "Ë¢ã", "common": true },
            { "id": 8, "category": "‰πæË≤®", "item": "Á§¶Ê≥âÊ∞¥", "quantity": 50, "unit": "ÁÆ±", "common": true },
            { "id": 9, "category": "‰πæË≤®", "item": "ËàíË∑ë", "quantity": 50, "unit": "ÁÆ±", "common": true },
            { "id": 10, "category": "‰πæË≤®", "item": "ËÄÅ‰πæÂ™Ω", "quantity": 3, "unit": "ÁÆ±", "common": true },
            { "id": 11, "category": "‰πæË≤®", "item": "Á∂≠Â£´ÊØî", "quantity": 2, "unit": "ÁÆ±", "common": true },
            { "id": 12, "category": "‰πæË≤®", "item": "Âï§ÈÖí", "quantity": 10, "unit": "ÁÆ±", "common": true },
            { "id": 13, "category": "‰πæË≤®", "item": "Â§ßËù¶", "quantity": 20, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 14, "category": "‰πæË≤®", "item": "È≠∑È≠ö", "quantity": 20, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 15, "category": "‰πæË≤®", "item": "Â°ëËÜ†ÊéÉÊää", "quantity": 10, "unit": "Êää", "common": true },
            { "id": 16, "category": "‰πæË≤®", "item": "Â°ëËÜ†ÁïöÁÆï", "quantity": 10, "unit": "ÂÄã", "common": true },
            { "id": 17, "category": "‰πæË≤®", "item": "ÊãñÊää", "quantity": 10, "unit": "Êää", "common": true },
            { "id": 18, "category": "‰πæË≤®", "item": "Á´πÊéÉÂ∏ö", "quantity": 10, "unit": "Êää", "common": true },
            { "id": 19, "category": "‰πæË≤®", "item": "Ê≤êÊµ¥Èú≤", "quantity": 24, "unit": "Áì∂", "common": true },
            { "id": 20, "category": "‰πæË≤®", "item": "È¶ôÁöÇ", "quantity": 30, "unit": "ÂÄã", "common": true },
            { "id": 21, "category": "‰πæË≤®", "item": "ÈπΩÂ∑¥", "quantity": 24, "unit": "Áì∂", "common": true },
            { "id": 22, "category": "‰πæË≤®", "item": "ÈÜ¨Ê≤π", "quantity": 24, "unit": "Áì∂", "common": true },
            { "id": 23, "category": "‰πæË≤®", "item": "ÈõûÁ≤â", "quantity": 10, "unit": "ÁΩê", "common": true },
            { "id": 24, "category": "‰πæË≤®", "item": "È≠öÁΩêÈ†≠", "quantity": 5, "unit": "ÁÆ±", "common": true },
            { "id": 25, "category": "‰πæË≤®", "item": "È¶ôËèá", "quantity": 10, "unit": "ÂÖ¨Êñ§", "common": true },
            { "id": 26, "category": "‰πæË≤®", "item": "Ëæ£Ê§íÈÜ¨", "quantity": 5, "unit": "Áì∂", "common": true },
            { "id": 27, "category": "‰πæË≤®", "item": "Â§ßÊ°∂ÁÖÆÈ£ØÊ≤π", "quantity": 8, "unit": "Ê°∂", "common": true },
            { "id": 28, "category": "‰πæË≤®", "item": "ÈªèÈº†Êùø", "quantity": 10, "unit": "Âºµ", "common": true },
            { "id": 29, "category": "‰πæË≤®", "item": "ÊÆ∫Ëü≤Âäë", "quantity": 10, "unit": "ÁΩê", "common": true },
            { "id": 30, "category": "‰∫îÈáë", "item": "Ëû∫Áµ≤", "quantity": 100, "unit": "ÂÄã", "common": true },
            { "id": 31, "category": "‰∫îÈáë", "item": "Á©∫Ê∞£Âø´ÈÄüÊé•È†≠", "quantity": 5, "unit": "ÂÄã", "common": true }
        ];

        let currentTab = 'food';
        let orderList = JSON.parse(localStorage.getItem('supplyOrderList')) || [];
        let currentModalItem = null;
        let editingIndex = -1;

        // --- Init ---
        document.addEventListener('DOMContentLoaded', () => {
            renderTabs();
            renderPresets();
            updateCartBadge();
        });

        // --- Core ---
        function renderTabs() {
            const container = document.getElementById('categoryTabs');
            container.innerHTML = TABS.map(tab => {
                const isActive = tab.id === currentTab;
                const activeClass = isActive
                    ? 'bg-primary text-white shadow-md transform scale-105'
                    : 'bg-white text-gray-500 border border-gray-100';
                return `<button onclick="switchTab('${tab.id}')" class="flex-shrink-0 px-5 py-2.5 rounded-full font-bold text-sm transition-all-200 ${activeClass}"><span class="mr-1">${tab.icon}</span> ${tab.label}</button>`;
            }).join('');
        }

        function renderPresets() {
            const container = document.getElementById('presetsGrid');
            const tabConfig = TABS.find(t => t.id === currentTab);
            const items = presetsData.filter(item => item.category === tabConfig.sourceCategory);

            if (items.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center text-gray-400 py-10">Ê≠§ÂàÜÈ°ûÂ∞öÁÑ°È†ÖÁõÆ</div>`;
                return;
            }

            container.innerHTML = items.map(item => {
                const isInCart = orderList.some(o => o.item === item.item && o.category === item.category);
                const activeClass = isInCart ? 'border-primary ring-2 ring-primary/20 bg-blue-50' : 'border-white bg-white hover:border-gray-200';
                const textClass = isInCart ? 'text-primary' : 'text-gray-800';

                return `
                <button onclick="handlePresetClick(${item.id})" class="p-4 rounded-2xl border-2 shadow-sm transition-all-200 tap-scale relative group overflow-hidden ${activeClass}">
                    ${isInCart ? '<div class="absolute top-2 right-2 text-primary check-icon"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></div>' : ''}
                    <div class="font-bold text-lg mb-1 ${textClass}">${item.item}</div>
                    <div class="text-xs text-gray-400 font-medium">È†êË®≠: ${item.quantity} ${item.unit}</div>
                </button>
                `;
            }).join('');
        }

        function switchTab(id) {
            currentTab = id;
            renderTabs();
            renderPresets();
        }

        function handlePresetClick(id) {
            const item = presetsData.find(p => p.id === id);
            if (!item) return;

            const existingIdx = orderList.findIndex(o => o.item === item.item && o.category === item.category);
            if (existingIdx !== -1) {
                if (confirm(`Á¢∫ÂÆöÁßªÈô§„Äå${item.item}„ÄçÔºü`)) removeItem(existingIdx);
            } else {
                openQtyModal(item);
            }
        }

        // --- Modals ---

        // Qty Modal
        function openQtyModal(item) {
            currentModalItem = item;
            document.getElementById('modalItemName').innerText = item.item;
            document.getElementById('modalQtyInput').value = item.quantity;
            document.getElementById('modalUnitHint').innerText = `ÂñÆ‰Ωç: ${item.unit}`;
            toggleModal('qtyModal', true);
            setTimeout(() => document.getElementById('modalQtyInput').select(), 50);
        }

        function closeQtyModal() {
            toggleModal('qtyModal', false);
            currentModalItem = null;
        }

        // Edit Modal
        function openEditModal(index) {
            editingIndex = index;
            const item = orderList[index];
            document.getElementById('editItemName').innerText = item.item;
            document.getElementById('editQtyInput').value = item.quantity;
            document.getElementById('editUnitInput').value = item.unit;
            toggleModal('editModal', true);
            setTimeout(() => document.getElementById('editQtyInput').select(), 50);
        }

        function closeEditModal() {
            toggleModal('editModal', false);
            editingIndex = -1;
        }

        function confirmEdit() {
            if (editingIndex === -1) return;
            const qty = parseFloat(document.getElementById('editQtyInput').value);
            const unit = document.getElementById('editUnitInput').value.trim();

            if (!qty || qty <= 0) return alert('Ë´ãËº∏ÂÖ•ÊúâÊïàÊï∏Èáè');
            if (!unit) return alert('Ë´ãËº∏ÂÖ•ÂñÆ‰Ωç');

            orderList[editingIndex].quantity = qty;
            orderList[editingIndex].unit = unit;

            saveAndRender();
            closeEditModal();
            showToast("Â∑≤Êõ¥Êñ∞");
        }

        // Custom Modal
        function openCustomModal() {
            const m = document.getElementById('customModal');
            m.classList.remove('hidden');
            setTimeout(() => {
                m.classList.remove('opacity-0');
                document.getElementById('customModalContent').classList.remove('translate-y-full');
            }, 10);
            document.getElementById('customName').focus();
        }

        function closeCustomModal() {
            const m = document.getElementById('customModal');
            document.getElementById('customModalContent').classList.add('translate-y-full');
            m.classList.add('opacity-0');
            setTimeout(() => {
                m.classList.add('hidden');
            }, 300);
        }

        function toggleModal(id, show) {
            const modal = document.getElementById(id);
            const content = modal.querySelector('div'); // first child

            if (show) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    content.classList.remove('scale-95');
                }, 10);
            } else {
                modal.classList.add('opacity-0');
                content.classList.add('scale-95');
                setTimeout(() => modal.classList.add('hidden'), 200);
            }
        }

        function adjustModalQty(inputId, delta) {
            const el = document.getElementById(inputId);
            let val = parseFloat(el.value) || 0;
            val += delta;
            if (val < 0) val = 0;
            el.value = val;
        }

        // --- Logic ---

        function confirmAddToOrder() {
            if (!currentModalItem) return;
            const qty = parseFloat(document.getElementById('modalQtyInput').value);
            addItem({ ...currentModalItem, quantity: qty, id: Date.now() });
            closeQtyModal();
        }

        function confirmAddCustom() {
            const cat = document.getElementById('customCat').value;
            const name = document.getElementById('customName').value.trim();
            const qty = parseFloat(document.getElementById('customQty').value);
            const unit = document.getElementById('customUnit').value.trim();

            if (!name) return alert('Ë´ãËº∏ÂÖ•ÂêçÁ®±');

            addItem({
                id: Date.now(),
                category: cat,
                item: name,
                quantity: qty || 1,
                unit: unit || 'ÂÄã'
            });

            // Clear inputs
            document.getElementById('customName').value = '';
            closeCustomModal();
        }

        function addItem(itemObj) {
            orderList.unshift(itemObj);
            saveAndRender();
            showToast(`Â∑≤Âä†ÂÖ•: ${itemObj.item}`);
        }

        function removeItem(index) {
            orderList.splice(index, 1);
            saveAndRender();
        }

        function saveAndRender() {
            localStorage.setItem('supplyOrderList', JSON.stringify(orderList));
            renderPresets();
            renderCartList();
            updateCartBadge();
        }

        function updateCartBadge() {
            const el = document.getElementById('cartBadge');
            if (orderList.length > 0) {
                el.innerText = orderList.length;
                el.classList.remove('hidden');
            } else {
                el.classList.add('hidden');
            }
        }

        // --- Cart Drawer ---

        function openCart() {
            renderCartList();
            const drawer = document.getElementById('cartDrawer');
            drawer.classList.remove('translate-x-full');
        }

        function closeCart() {
            document.getElementById('cartDrawer').classList.add('translate-x-full');
        }

        function renderCartList() {
            const container = document.getElementById('cartList');
            if (orderList.length === 0) {
                container.innerHTML = `<div class="text-center py-20 text-gray-400">Ë≥ºÁâ©ËªäÊòØÁ©∫ÁöÑ</div>`;
                return;
            }

            container.innerHTML = orderList.map((item, index) => `
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex justify-between items-center animate-fade-in">
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <span class="text-xs font-bold text-gray-400 bg-gray-100 px-1.5 py-0.5 rounded">${item.category}</span>
                            <span class="font-bold text-gray-800 text-lg">${item.item}</span>
                        </div>
                        <div class="text-sm text-gray-500">Êï∏Èáè: <span class="font-bold text-gray-800">${item.quantity}</span> ${item.unit}</div>
                    </div>
                    <div class="flex items-center gap-2">
                         <button onclick="openEditModal(${index})" class="p-2 text-gray-400 hover:text-primary transition-colors bg-gray-50 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                            </svg>
                        </button>
                        <button onclick="removeItem(${index})" class="p-2 text-gray-400 hover:text-red-500 transition-colors bg-gray-50 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function downloadJSON() {
            if (orderList.length === 0) return alert("Ê∏ÖÂñÆÊòØÁ©∫ÁöÑ");
            const dataStr = JSON.stringify(orderList, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const now = new Date();
            const filename = `supply_order_${now.getFullYear()}${(now.getMonth() + 1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}.json`;
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.remove('opacity-0', 'translate-y-4');
            t.classList.add('opacity-100');
            setTimeout(() => {
                t.classList.remove('opacity-100');
                t.classList.add('opacity-0');
            }, 2000);
        }
    </script>
</body>

</html>